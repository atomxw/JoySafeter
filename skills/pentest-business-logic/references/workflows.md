# Workflows

## Business Logic Attack Patterns

## AI-assisted selection

1. Map all multi-step workflows from recon deliverables and source code.
2. Identify business constraints (price, quantity, role, time, limits).
3. Select attack patterns based on workflow type and constraint category.
4. Execute tests in order: workflow bypass → data integrity → limit abuse → file upload → payment.

---

## workflow_circumvention

Test whether multi-step processes enforce step ordering server-side.

- playwright_skip_step: skip_to_step 3, expected_redirect "/step1"
- burp_repeater: replay final-step request without completing prior steps
- test_vectors:
  - Direct URL access to step N without completing steps 1..N-1
  - Replay step N request with only step 1 session state
  - Reorder steps (submit step 3 before step 2)
  - Replay completed workflow to duplicate outcomes
  - Remove or modify workflow state tokens between steps

## data_validation_abuse

Test server-side validation of business-critical fields.

- burp_intruder: attack_type "sniper", positions ["price", "quantity", "discount"]
- payloads:
  - Negative values: -1, -100, -0.01
  - Zero values: 0, 0.00, 0e0
  - Boundary values: MAX_INT, MAX_INT+1, 999999999
  - Type confusion: "abc" for numeric fields, [] for string fields
  - Precision abuse: 0.001, 99.999, 1e308
  - Currency confusion: different currency codes if applicable

## function_limit_bypass

Test whether per-user or per-session limits are enforced server-side.

- aiohttp_parallel: concurrency 50, requests [identical coupon-apply requests]
- burp_repeater: apply same coupon code in rapid succession
- test_vectors:
  - Apply same coupon/promo code multiple times
  - Referral link self-referral or circular referral chains
  - Vote/like the same item from same session repeatedly
  - Exceed "one per customer" limits via parallel requests
  - Reset limit counters by clearing cookies or changing session
  - Abuse free trial by re-registering with different email

## file_upload_abuse

Test file upload business logic for type/size/content bypass.

- upload_file: content_type "image/png", filename_override "test.php.png"
- generate_polyglot: base_type "png", embed_type "php", payload "<?php phpinfo(); ?>"
- test_vectors:
  - Upload .php/.jsp/.aspx with image Content-Type header
  - Double extension: file.php.jpg, file.asp;.jpg
  - Null byte: file.php%00.jpg
  - Polyglot files valid as both image and script
  - Oversized files exceeding stated limits
  - Empty files or zero-byte uploads
  - Path traversal in filename: ../../../etc/cron.d/shell

## payment_manipulation

Test payment flow integrity at each stage.

- burp_repeater: modify price/total fields between checkout steps
- playwright_workflow: complete checkout with manipulated cart
- test_vectors:
  - Modify price in client-side request before server processes
  - Change quantity after price calculation but before payment
  - Apply multiple discount codes that should be exclusive
  - Negative quantity to generate credit/refund
  - Currency code switching mid-transaction
  - Race condition: add items after total is calculated
  - Replay successful payment confirmation for new orders

## request_forgery

Test whether critical actions validate request authenticity.

- burp_repeater: remove/modify CSRF tokens, replay old tokens
- test_vectors:
  - Submit forms without CSRF token
  - Reuse CSRF token from different session
  - Modify hidden form fields (user_id, role, account_type)
  - Parameter pollution: duplicate parameters with conflicting values
  - Mass assignment: add extra fields (isAdmin, balance, role)

## Reporting and validation

- Document each finding with business impact (financial loss, data integrity, compliance)
- Include step-by-step reproduction with exact HTTP requests
- Calculate potential financial impact where applicable
- Classify severity based on business impact, not just technical severity
