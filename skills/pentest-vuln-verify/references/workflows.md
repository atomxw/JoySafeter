# 验证工作流

## 验证逻辑

核心验证过程遵循此严格定义的流程，以确保在不同会话上下文下准确复现漏洞。

### 1. 输入处理
**必需输入：**
- `target_url`（必需，基础 URL）
- `raw_request_base64`（必需，Base64 编码的完整 HTTP 请求）
- `vuln_type`（例如 "open_redirect", "xss"）

**可选输入：**
- `cookie`（高优先级：覆盖原始请求 Cookie）
- `verify_domains`（用于验证重定向的域名列表。默认值：`["baidu.com", "taobao.com"]`）
- `username` / `password`（仅元数据，未在当前自动化逻辑中使用）

### 2. 请求重构策略
系统使用 `curl` 重构并发送请求。

**标头清理与 Cookie 处理：**
1. **Curl 标志**：
   - `-i`: 在输出中包含协议标头（检查 `Location` 标头至关重要）。
   - `-s`: 静默模式（抑制进度条）。
   - `-k`: 允许不安全的服务器连接（跳过 SSL 验证）。
   - `-L`: **禁用**。我们必须**不**自动跟随重定向，以捕获初始的 301/302 响应。
2. **Cookie 注入**：
   - 如果提供了 `cookie` 参数，则通过 `-H "Cookie: ..."` 注入。
   - 如果未提供 Cookie，则请求依赖于通过 `-H` 传递的标头。

### 3. Payload 投递
- 执行构造的 `curl` 命令。
- 捕获输出以进行模式匹配。

## 成功标准

仅当响应中满足以下条件之一时，验证才被视为**成功**：

### 条件 A：HTTP Location 重定向
- 响应状态码为 `301` 或 `302`。
- `Location` 标头包含：
  - `baidu.com`
  - 或 `taobao.com`

### 条件 B：DOM/Meta 重定向
- 响应状态码为 `200`。
- 响应正文包含特定的重定向向量：
  - `<meta http-equiv="refresh" content="...url=...baidu.com...">`
  - `window.location.href = "...taobao.com..."`
