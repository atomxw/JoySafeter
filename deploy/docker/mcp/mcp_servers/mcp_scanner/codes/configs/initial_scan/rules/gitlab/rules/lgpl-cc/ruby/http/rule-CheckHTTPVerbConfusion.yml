# yamllint disable
# License: Commons Clause License Condition v1.0[LGPL-2.1-only]
# yamllint enable
---
rules:
- id: "ruby_http_rule-CheckHTTPVerbConfusion"
  mode: search
  patterns:
  - pattern: |
      if request.get?
        ...
      else
        ...
      end
  - pattern-not-inside: |
      if ...
      elsif ...
        ...
      end
  message: |
    Found an improperly constructed control flow block with `request.get?`. 
    Rails will route HEAD requests as GET requests but they will fail the 
    `request.get?` check, potentially causing unexpected behavior unless an 
    `elsif` condition is used.

    Secure Code Example:
    ```
    if request.get?
      # Handle GET request logic here
    elsif request.head?
      # Handle HEAD request logic here
    else
      # Handle others if needed
    end
    ```
  languages:
  - "ruby"
  severity: "WARNING"
  metadata:
    category: "security"
    shortDescription: "Improper check for unusual or exceptional conditions"
    cwe: "CWE-754"
    owasp:
    - "A6:2017-Security Misconfiguration"
    - "A04:2021-Insecure Design"
    security-severity: "MEDIUM"
    technology:
    - "ruby"
    - "rails"
    references:
    - "https://github.com/semgrep/semgrep-rules/blob/develop/ruby/rails/security/brakeman/check-http-verb-confusion.yaml"

  