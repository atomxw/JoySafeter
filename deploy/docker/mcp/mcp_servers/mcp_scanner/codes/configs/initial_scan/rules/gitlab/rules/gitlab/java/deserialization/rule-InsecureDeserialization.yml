# yamllint disable
# License: The GitLab Enterprise Edition (EE) license (the “EE License”)
# yamllint enable
---
rules:
  - id: java_deserialization_rule-InsecureDeserialization
    languages:
      - java
    mode: taint
    pattern-sources:
      - patterns:
          - pattern-inside: |
              $FUNC (..., byte[] $X, ...) { 
                ... 
              }
          - focus-metavariable: $X 
    pattern-propagators:
      - pattern: $V = new ObjectInputStream($X)
        from: $X
        to: $V
    pattern-sinks:
      - pattern: $V.readObject(...)
    message: |
      Deserialization attacks exploit the process of reading serialized data and turning it back into an
      object. By constructing malicious objects and serializing them, an adversary may attempt to:

      - Inject code that is executed upon object construction, which occurs during the deserialization process.
      - Exploit mass assignment by including fields that are not normally a part of the serialized data but are
        read in during deserialization.

      Consider safer alternatives such as serializing data in the JSON format. Ensure any format chosen allows
      the application to specify exactly which object types are allowed to be deserialized. Additionally, when
      deserializing, never deserialize to base object types like `Object` and only cast to the exact object
      type that is expected.

      To protect against mass assignment, only allow deserialization of the specific fields that are required.
      If this is not easily done, consider creating an intermediary type that can be serialized with only the
      necessary fields exposed.

      For more details on deserialization attacks in general, see OWASP's guide:
      https://cheatsheetseries.owasp.org/cheatsheets/Deserialization_Cheat_Sheet.html
    severity: "WARNING"
    metadata:
      shortDescription: "Deserialization of Untrusted Data"
      category: "security"
      cwe: "CWE-502"
      owasp:
        - "A8:2017-Insecure Deserialization"
        - "A08:2021-Software and Data Integrity Failures"
      technology:
        - "java"
      security-severity: "Medium"
