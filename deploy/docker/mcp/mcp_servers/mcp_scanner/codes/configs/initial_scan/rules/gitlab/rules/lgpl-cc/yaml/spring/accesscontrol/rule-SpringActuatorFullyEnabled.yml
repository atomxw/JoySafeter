# yamllint disable
# License: Commons Clause License Condition v1.0[LGPL-2.1-only]
# source (original): https://semgrep.dev/r/java.spring.security.audit.spring-actuator-fully-enabled-yaml.spring-actuator-fully-enabled-yaml
# yamllint enable
---
rules:
- id: "yaml_spring_rule-SpringActuatorFullyEnabled"
  languages:
  - "yaml"
  severity: "WARNING"
  message: |
    Spring Boot Actuator is fully enabled. This exposes sensitive endpoints
    such as /actuator/env, /actuator/logfile, /actuator/heapdump and others.
    If the application lacks proper security measures (e.g., authentication and 
    authorization), sensitive data could be accessed, compromising the application and 
    its infrastructure. This configuration poses a serious risk in production 
    environments or public-facing deployments.

    To mitigate the risks, take the following measures:
      - Expose only the Actuator endpoints required for your use case
      - For production environments, restrict exposure to non-sensitive endpoints 
      like `health` or `info`
      - Ensure Actuator endpoints are protected with authentication and authorization 
      (e.g., via Spring Security)
      - Use environment-specific configurations to limit exposure in production

    Secure Code Example:
    Instead of include: "*", list only the endpoints you need to expose:
    ```
    management:
      endpoints:
        web:
          exposure:
            include: "health,info,metrics"
    ```
    
    References:
    - https://docs.spring.io/spring-boot/reference/actuator/endpoints.html#actuator.endpoints.exposing
    - https://medium.com/walmartglobaltech/perils-of-spring-boot-actuators-misconfiguration-185c43a0f785
    - https://blog.maass.xyz/spring-actuator-security-part-1-stealing-secrets-using-spring-actuators
  metadata:
    likelihood: MEDIUM
    impact: HIGH
    confidence: MEDIUM
    shortDescription: "Exposure of sensitive system information to an unauthorized control sphere"
    category: "security"
    cwe: "CWE-497"
    owasp:
    - "A01:2021-Broken Access Control"
    - "A3:2017-Sensitive Data Exposure"
    security-severity: "Medium"
    technology:
    - "java"
  patterns:
  - pattern: |
      management:
        ...
        endpoints:
          ...
          web:
            ...
            exposure:
              ...
              include: "*"
              ...
