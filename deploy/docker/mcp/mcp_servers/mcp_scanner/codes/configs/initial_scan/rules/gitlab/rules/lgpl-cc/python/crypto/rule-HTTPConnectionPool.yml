# yamllint disable
# License: Commons Clause License Condition v1.0[LGPL-2.1-only]
# https://github.com/semgrep/semgrep-rules/blob/release/python/lang/security/audit/network/http-not-https-connection.yaml
# yamllint enable
---
rules:
  - id: python_crypto_rule-HTTPConnectionPool
    languages:
      - python
    pattern-either:
      - pattern: urllib3.HTTPConnectionPool(...)
      - pattern: urllib3.connectionpool.HTTPConnectionPool(...)
    message: |
      The application is using HTTPConnectionPool method. This method transmits
      data in cleartext, which is vulnerable to MITM (Man in the middle)
      attacks. In MITM attacks, the data transmitted over the unencrypted
      connection can be intercepted, read and/or modified by unauthorized
      parties which can lead to data integrity and confidentiality loss. 

      To mitigate this issue, use HTTPSConnectionPool instead, which encrypts 
      communications and enhances security.

      Secure Code Example:
      ```
      import urllib3
      spool = urllib3.connectionpool.HTTPSConnectionPool("example.com")
      ```
    metadata:
      category: "security"
      cwe: "CWE-319"
      shortDescription: "Cleartext transmission of sensitive information"
      owasp:
        - "A3:2017-Sensitive Data Exposure"
        - "A02:2021-Cryptographic Failures"
      security-severity: "MEDIUM"
      references:
        - "https://urllib3.readthedocs.io/en/1.2.1/pools.html#urllib3.connectionpool.HTTPSConnectionPool"
      technology:
        - "python"
      subcategory:
        - "audit"
      likelihood: "MEDIUM"
      impact: "MEDIUM"
      confidence: "MEDIUM"
    severity: "WARNING"
