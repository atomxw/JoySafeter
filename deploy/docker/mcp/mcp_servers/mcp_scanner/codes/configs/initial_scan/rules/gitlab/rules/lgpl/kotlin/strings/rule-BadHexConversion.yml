# yamllint disable
# License: GNU Lesser General Public License v3.0
# source (original): https://find-sec-bugs.github.io/bugs.htm
# yamllint enable
---
rules:
  - id: "kotlin_strings_rule-BadHexConversion"
    languages:
      - "kotlin"
    message: |
      When converting a byte array containing a hash signature to a human readable string, a
      conversion mistake can be made if the array is read byte by byte.
    metadata:
      shortDescription: "Incorrect type conversion or cast"
      cwe: "CWE-704"
      category: "security"
      confidence: "HIGH"
      owasp:
        - "A6:2017-Security Misconfiguration"
        - "A05:2021-Security Misconfiguration"
      security-severity: "MEDIUM"
    severity: "WARNING"

    patterns:
      - pattern-inside: |
          $B_ARR = ($MD: java.security.MessageDigest).digest(...);
          ...
      - pattern-either:
          - pattern: |
              for($B in $B_ARR) {
                ...
                $B_TOSTR
              }
          - pattern: |
              while(...) {
                ...
                $B_TOSTR
              }
          - pattern: |
              do {
                ...
                $B_TOSTR
              } while(...)
      - metavariable-pattern:
          metavariable: $B_TOSTR
          patterns:
            - pattern-either:
                - pattern: java.lang.Integer.toHexString($B_TOINT)
                - pattern: Integer.toHexString($B_TOINT)
                - pattern: $B_TOINT.toHexString(...)
            - metavariable-pattern:
                metavariable: $B_TOINT
                pattern-either:
                  - pattern: $B_ARR[...].toInt()
                  - pattern: $B_ARR[...]
                  - pattern: $B.toInt()
                  - pattern: $B
