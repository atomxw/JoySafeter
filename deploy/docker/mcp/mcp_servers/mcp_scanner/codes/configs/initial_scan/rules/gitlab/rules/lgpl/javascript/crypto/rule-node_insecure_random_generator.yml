# yamllint disable
# License: GNU Lesser General Public License v3.0
# yamllint enable
---
rules:
  - id: "rules_lgpl_javascript_crypto_rule-node-insecure-random-generator"
    pattern-either:
      - patterns:
          - pattern-inside: |
              require('crypto')
              ...
          - pattern: |
              $X.pseudoRandomBytes(...)
      - pattern: |
          Math.random(...)
    message: |
      This rule identifies use of cryptographically weak random number generators.
      Using cryptographically weak random number generators like `crypto.pseudoRandomBytes()` 
      and `Math.random()` for security-critical tasks can expose systems to significant 
      vulnerabilities. Attackers might predict the generated random numbers, compromising 
      the integrity and confidentiality of cryptographic operations. This could lead to 
      breaches where sensitive data is accessed or manipulated, authentication mechanisms 
      are bypassed, or secure communications are intercepted, ultimately undermining the 
      security of the entire system or application.

      Mitigation strategy:
      Replace the use of these cryptographically weak random number generators with 
      `crypto.randomBytes()`, a method provided by Node.js's `crypto` module that 
      generates cryptographically secure random numbers. This method should be used 
      for all operations requiring secure randomness, such as generating keys, tokens, 
      or any cryptographic material.

      Secure Code Example:
      ```
      const crypto = require('crypto');
      const secureBytes = crypto.randomBytes(256);
      console.log(`Secure random bytes: ${secureBytes.toString('hex')}`);
      ```
    languages:
      - "javascript"
    severity: "WARNING"
    metadata:
      owasp:
        - "A3:2017-Sensitive Data Exposure"
        - "A02:2021-Cryptographic Failures"
      cwe: "CWE-338"
      shortDescription: "Use of cryptographically weak pseudo-random number generator (PRNG)"
      security-severity: "MEDIUM"
      category: "security"
      
