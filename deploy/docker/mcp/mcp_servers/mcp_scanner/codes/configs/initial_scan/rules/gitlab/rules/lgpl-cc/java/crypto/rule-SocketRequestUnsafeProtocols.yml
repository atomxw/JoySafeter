# yamllint disable
# License: Commons Clause License Condition v1.0[LGPL-2.1-only]
# yamllint enable
---
rules:
  - id: java_crypto_rule-SocketRequestUnsafeProtocols
    message: |
      This code establishes a network connection using an insecure protocol
      (HTTP, FTP, or Telnet). These protocols transmit data in cleartext, which
      can be intercepted and read by malicious actors. This exposure of
      sensitive information violates security best practices and can lead to
      data breaches.

      To mitigate the vulnerability, consider using secure protocols that encrypt
      the transmission of data. For web traffic, replace HTTP with HTTPS, which
      uses SSL/TLS to protect the data in transit. For file transfers, use SFTP
      or FTPS instead of FTP. For remote terminal access, use SSH instead of Telnet.

      Secure Code Example:
      ```
      public void safe() {
        BufferedReader in = null;
        PrintWriter out = null;
        Socket pingSocket = null;
        try{
            pingSocket = new Socket("ssh://example.com", 22);
            out = new PrintWriter(pingSocket.getOutputStream(), true);
            in = new BufferedReader(new InputStreamReader(pingSocket.getInputStream()));
            out.println("ping");
            System.out.println(in.readLine());
          } catch (Exception e) {
              e.printStackTrace();
          } finally {
            try {
                if (in != null) in.close();
                if (pingSocket != null) pingSocket.close();
            } catch (IOException e) {
                System.out.println("Failed to close resources: " + e.getMessage());
            }
          }
      }
      ```
    severity: "WARNING"
    metadata:
      likelihood: "MEDIUM"
      impact: "MEDIUM"
      confidence: "LOW"
      category: "security"
      cwe: "CWE-319"
      shortDescription: "Cleartext transmission of sensitive information"
      owasp:
        - "A3:2017-Sensitive Data Exposure"
        - "A02:2021-Cryptographic Failures"
      security-severity: "MEDIUM"
      references:
        - "https://docs.oracle.com/javase/8/docs/api/java/net/Socket.html"
      technology:
        - "java"
      vulnerability: "Insecure Transport"
      license: "Commons Clause License Condition v1.0[LGPL-2.1-only]"
      vulnerability_class:
        - "Mishandled Sensitive Information"
    languages:
      - "java"
    pattern-either:
      - pattern: |
          $SOCKET = new java.net.Socket("=~/^ftp://.+/i", ...);
      - pattern: |
          $SOCKET = new java.net.Socket("=~/^http://.+/i", ...);
      - pattern: |
          $SOCKET = new java.net.Socket("=~/^telnet://.+/i", ...);
      - patterns:
          - pattern: |
              $SOCKET = new java.net.Socket("...", $PORT);
          - metavariable-comparison:
              comparison: $PORT in [23,21,80]
              metavariable: $PORT
