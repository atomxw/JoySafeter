# yamllint disable
# License: GNU Lesser General Public License v3.0
# yamllint enable
---
rules:
  - id: rules_lgpl_javascript_crypto_rule-node-sha1
    pattern-either:
      - patterns:
          - pattern-either:
              - patterns:
                  - pattern-inside: |
                      $Y = $X.createHash('sha1')
                      ...
                  - pattern: |
                      $Y.update("...")
              - pattern: |
                  $X.createHash('sha1').update("...")
      - patterns:
          - pattern-inside: |
              require('crypto-js')
              ...
          - pattern: |
              $X.SHA1("...")
      - patterns:
          - pattern-either:
              - pattern-inside: |
                  $M = require('sha1')
                  ...
              - pattern-inside: |
                  $M = require('js-sha1')
                  ...
          - pattern: |
              $M("...")
      - patterns:
          - pattern-inside: |
              require('node-forge')
              ...
          - pattern-either:
              - patterns:
                  - pattern-inside: |
                      $Y = $X.md.sha1.create()
                      ...
                  - pattern: |
                      $Y.update("...")
              - pattern: |
                  $X.md.sha1.create().update("...")
      - patterns:
          - pattern-inside: |
              $X = require('jshashes')
              ...
              $Y = new $X.SHA1()
              ...
          - pattern: |
              $Y.$METHOD("...")
      - patterns:
          - pattern-inside: |
              require('hash.js')
              ...
          - pattern-either:
              - patterns:
                  - pattern-inside: |
                      $Y = $X.sha1()
                      ...
                  - pattern: |
                      $Y.update("...")
              - pattern: |
                  $X.sha1().update("...")
      - patterns:
          - pattern-inside: |
              $X = require('jssha')
              ...
          - pattern-either:
              - pattern: |
                  new $X('SHA-1', ...).update("...")
              - patterns:
                  - pattern-inside: |
                      $Y = new $X('SHA-1', ...)
                      ...
                  - pattern: |
                      $Y.update("...")
      - patterns:
          - pattern-either:
              - pattern: |
                  $X('sha1').update("...")
              - patterns:
                  - pattern-inside: |
                      $Y = $X('sha1')
                      ...
                  - pattern: |
                      $Y.update("...")
      - pattern: |
          $X.subtle.digest('SHA-1', ...)
      - patterns:
          - pattern-either:
              - pattern: |
                  $X.SHA1.digest(...)
              - patterns:
                  - pattern-inside: |
                      $Y = $X.SHA1
                      ...
                  - pattern: |
                      $Y.digest(...)  
      - patterns:
          - pattern-either:
              - pattern: |
                  $X.codec.hex.fromBits($SJCL)
              - patterns:
                  - pattern-inside: |
                      $Y = $SJCL
                      ...
                  - pattern: |
                      $X.codec.hex.fromBits($Y)
          - metavariable-pattern:
              metavariable: $SJCL
              pattern: |
                $K.hash.sha1.hash("...")
    message: |
      The SHA-1 hashing algorithm is no longer considered secure for
      cryptographic applications due to its vulnerability to collision attacks,
      where two different inputs produce the same output hash. SHA-1's
      susceptibility to collision attacks undermines the security of
      cryptographic operations, allowing attackers to forge signatures or
      manipulate data without detection. This poses significant risks in
      authentication systems, data integrity validations, and secure
      communications. 

      Remediation: To mitigate this vulnerability, replace the SHA1 hashing 
      algorithm with  stronger cryptographic hash functions, such as SHA-256 
      or SHA-3. These  algorithms offer significantly improved security and 
      are resistant to  collision attacks, making them suitable for cryptographic 
      purposes in  modern applications.

      Secure Code example:  
      ```  
      const crypto = require('crypto');  
      const hash = crypto.createHash('sha256').update('sensitive data').digest('hex');  
      console.log(hash);   
      ```
    languages:
      - "javascript"
    severity: "WARNING"
    metadata:
      shortDescription: "Use of weak hash"
      category: "security"
      owasp:
        - "A3:2017-Sensitive Data Exposure"
        - "A02:2021-Cryptographic Failures"
      cwe: "CWE-328"
      security-severity: "MEDIUM"
