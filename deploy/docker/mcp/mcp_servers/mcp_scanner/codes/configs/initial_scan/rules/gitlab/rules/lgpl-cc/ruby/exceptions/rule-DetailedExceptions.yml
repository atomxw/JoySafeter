# yamllint disable
# License: Commons Clause License Condition v1.0[LGPL-2.1-only]
# yamllint enable
---
rules:
- id: "ruby_exceptions_rule-DetailedExceptions"
  patterns:
  - pattern-either:
    - patterns:
      - pattern: |
          config.consider_all_requests_local = true
    - patterns:
      - pattern-inside: |
          class $CONTROLLER < ApplicationController
            ...
          end
      - pattern: |
          def show_detailed_exceptions? (...)
            ...
          return $RETURN
          end
      - metavariable-pattern:
          metavariable: $RETURN
          patterns:
          - pattern-not: |
              false
  message: |
    The `consider_all_requests_local` setting was found set to true, which enables detailed exception reports. This setting, 
    while useful during development for debugging purposes, can 
    inadvertently expose sensitive system or application information 
    to end users when enabled in production environments. Such 
    information exposure could potentially aid attackers in crafting 
    further attacks against the system.

    It is advisable to disable detailed exception reporting in production 
    environments to prevent the leakage of sensitive information. 

    Secure Configuration Example:
    ```
    # config/environments/production.rb
    Rails.application.config.consider_all_requests_local = false
    ```
  languages: 
  - "ruby"
  severity: "WARNING"
  metadata:
    owasp:
    - "A3:2017-Sensitive Data Exposure"
    - "A05:2021-Security Misconfiguration"
    shortDescription: "Generation of error message containing sensitive information"
    cwe: "CWE-209" 
    category: "security"
    security-severity: "MEDIUM"
    technology:
    - "rails"
    references:
    - "https://github.com/semgrep/semgrep-rules/blob/develop/ruby/rails/security/audit/detailed-exceptions.yaml"
