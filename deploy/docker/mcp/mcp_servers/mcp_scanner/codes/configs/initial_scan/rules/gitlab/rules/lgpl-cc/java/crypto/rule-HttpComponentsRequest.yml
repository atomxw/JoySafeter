# yamllint disable
# License: Commons Clause License Condition v1.0[LGPL-2.1-only]
# yamllint enable
rules:
  - id: java_crypto_rule-HttpComponentsRequest
    message: |
      Detected an HTTP GET request sent via Apache HTTP Components. Sending data
      over HTTP can expose sensitive information to interception or modification
      by attackers, as HTTP does not encrypt the data transmitted. It is critical
      to use HTTPS, which encrypts the communication, to protect the confidentiality
      and integrity of data in transit.

      To mitigate the issue, ensure all data transmitted between the client and 
      server is sent over HTTPS. Update all HTTP URLs to HTTPS and configure your 
      server to redirect HTTP requests to HTTPS. Additionally, implement HSTS 
      (HTTP Strict Transport Security) to enforce secure connections.
      Secure Code Example:
      ```
      private static void safe() {
        CloseableHttpClient httpclient = HttpClients.createDefault();
        CloseableHttpResponse response = httpclient.execute(new HttpPost("https://example.com"));
      }
      ```
    severity: WARNING
    metadata:
      shortDescription: "Cleartext transmission of sensitive information"
      security-severity: "MEDIUM"
      likelihood: "MEDIUM"
      impact: "MEDIUM"
      confidence: "MEDIUM"
      category: "security"
      cwe: "CWE-319"
      owasp:
        - "A3:2017-Sensitive Data Exposure"
        - "A02:2021-Cryptographic Failures"
      references:
        - "https://hc.apache.org/httpcomponents-client-ga/quickstart.html"
      subcategory:
        - "vuln"
      technology:
        - "java"
      vulnerability: "Insecure Transport"
      license: "Commons Clause License Condition v1.0[LGPL-2.1-only]"
      vulnerability_class:
        - "Mishandled Sensitive Information"
    languages:
      - "java"
    mode: taint
    pattern-sources:
      - pattern: |
          "=~/^http://.+/i"
    pattern-sinks:
      - pattern: (org.apache.http.impl.client.CloseableHttpClient $A).execute($HTTPREQ);
