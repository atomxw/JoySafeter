# yamllint disable
# License: Commons Clause License Condition v1.0[LGPL-2.1-only]
# yamllint enable
---
rules:
  - id: java_ftp_rule-FTPInsecureTransport
    message: |
      This rule identifies instances where the application uses FTP (File
      Transfer Protocol) for transferring files. FTP transmits data in clear
      text, allowing usernames, passwords, and other sensitive information to be
      intercepted by attackers. Consider using secure alternatives like SFTP
      (SSH File Transfer Protocol) or FTPS (FTP Secure) that provide encryption
      to protect data in transit.

      Remediation Strategy: To mitigate the risks associated with using unencrypted
      FTP, the application should switch to a secure file transfer protocol like
      SFTP or FTPS. Below is an example of how to implement FTPS in a Java
      application.

      ``` 
      import org.apache.commons.net.ftp.FTPSClient;

      public class FTPSExample {
          public static void main(String[] args) {
              String server = "ftps.example.com";
              int port = 21;
              String user = "your_username";
              String pass = "your_password";

              FTPSClient ftpsClient = new FTPSClient();
              try {
                  ftpsClient.connect(server, port);
                  ftpsClient.login(user, pass);
                  // Perform file operations

                  ftpsClient.logout();
                  ftpsClient.disconnect();
              } catch (Exception e) {
                  e.printStackTrace();
              }
          }
      } 
      ```
    severity: WARNING
    metadata:
      security-severity: MEDIUM
      shortDescription: Cleartext transmission of sensitive information
      category: security
      cwe: CWE-319
      owasp:
        - A3:2017-Sensitive Data Exposure
        - A02:2021-Cryptographic Failures
      references:
        - https://www.codejava.net/java-se/ftp/connect-and-login-to-a-ftp-server
        - https://commons.apache.org/proper/commons-net/apidocs/org/apache/commons/net/ftp/FTPClient.html
      subcategory:
        - vuln
      technology:
        - java
      vulnerability: Insecure Transport
      license: Commons Clause License Condition v1.0[LGPL-2.1-only]
    languages:
      - java
    pattern-either:
      - pattern: |
          (org.apache.commons.net.ftp.FTPClient $FTPCLIENT).connect(...);
      - pattern: |
          URL $URL = new URL("=~/^[fF][tT][pP]://.*/");
          ...
          URLConnection $CONN = $URL.openConnection(...);
