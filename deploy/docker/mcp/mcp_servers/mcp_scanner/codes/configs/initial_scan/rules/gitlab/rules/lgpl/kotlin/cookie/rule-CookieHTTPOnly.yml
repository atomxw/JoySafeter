# yamllint disable
# License: GNU Lesser General Public License v3.0
# source (original): https://find-sec-bugs.github.io/bugs.htm
# yamllint enable
---
rules:
  - id: "kotlin_cookie_rule-CookieHTTPOnly"
    languages:
      - "kotlin"
    message: |
      A new cookie is created without the HttpOnly flag set. The HttpOnly flag is a directive to the
      browser to make sure that the cookie can not be red by malicious script. When a user is the
      target of a "Cross-Site Scripting", the attacker would benefit greatly from getting the session
      id for example.
    severity: "WARNING"
    metadata:
      shortDescription: "Sensitive cookie without 'HttpOnly' flag"
      category: "security"
      owasp:
        - "A6:2017-Security Misconfiguration"
        - "A05:2021-Security Misconfiguration"
      cwe: "CWE-1004"
      technology:
        - "kotlin"
      security-severity: "MEDIUM"

    patterns:
      - pattern: |
          $C = $X.servlet.http.Cookie(..., ...)
          ...;
          ($RESP: $X.servlet.http.HttpServletResponse).addCookie($C)
      - pattern-not-inside: |
          $C = $X.servlet.http.Cookie(..., ...)
          ...
          $C.setHttpOnly(true)
          ...;
          ($RESP: $X.servlet.http.HttpServletResponse).addCookie($C)
