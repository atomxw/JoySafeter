# yamllint disable
# License: Commons Clause License Condition v1.0[LGPL-2.1-only]
# https://github.com/semgrep/semgrep-rules/blob/release/problem-based-packs/insecure-transport/java-spring/spring-http-request.yaml
# yamllint enable
---
rules:
  - id: java_crypto_rule-SpringHTTPRequestRestTemplate
    message: |
      This rule detects instances where Java Spring's RestTemplate API sends 
      requests to non-secure (http://) URLs. Sending data over HTTP is vulnerable 
      as it does not use TLS encryption, exposing the data to interception, 
      modification, or redirection by attackers. 
      
      To mitigate this vulnerability, modify the request URLs to use HTTPS instead, 
      which ensures that the data is encrypted during transit and prevents from
      MITM attacks. 

      Secure Code Example:
      ```
      public void safe(Object obj) throws Exception {
        RestTemplate restTemplate = new RestTemplate();
        restTemplate.put(URI.create("https://example.com"), obj);
      }
      ```  
    severity: "WARNING"
    metadata:
      likelihood: "MEDIUM"
      impact: "MEDIUM"
      confidence: "MEDIUM"
      category: "security"
      cwe: "CWE-319"
      shortDescription: "Cleartext transmission of sensitive information"
      owasp:
        - "A3:2017-Sensitive Data Exposure"
        - "A02:2021-Cryptographic Failures"
      security-severity: "MEDIUM"
      references:
        - "https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/client/RestTemplate.html#delete-java.lang.String-java.util.Map-"
        - "https://www.baeldung.com/rest-template"
      subcategory:
        - "vuln"
      technology:
        - "spring"
      vulnerability: "Insecure Transport"
      license: "Commons Clause License Condition v1.0[LGPL-2.1-only]"
      vulnerability_class:
        - "Mishandled Sensitive Information"
    languages:
      - "java"
    mode: "taint"
    pattern-sources:
      - pattern: |
          "=~/^http:\/\/.+/i"
    pattern-sinks:
      - patterns:
          - pattern: |
              (org.springframework.web.client.RestTemplate $RESTTEMP).$FUNC($URL, ...);
          - focus-metavariable: $URL
          - metavariable-regex:
              metavariable: $FUNC
              regex: (delete|doExecute|exchange|getForEntity|getForObject|headForHeaders|optionsForAllow|patchForObject|postForEntity|postForLocation|postForObject|put|execute)

