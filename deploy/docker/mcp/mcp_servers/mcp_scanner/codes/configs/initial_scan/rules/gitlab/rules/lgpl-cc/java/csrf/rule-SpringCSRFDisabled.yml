# yamllint disable
# License: Commons Clause License Condition v1.0[LGPL-2.1-only]
# yamllint enable
---
rules:
  - id: "java_csrf_rule-SpringCSRFDisabled"
    languages:
      - "java"
    pattern-either:
      - pattern: (org.springframework.security.config.annotation.web.builders.HttpSecurity $H). ... .csrf(...). ... .requireCsrfProtectionMatcher(...)
      - pattern: (org.springframework.security.config.annotation.web.builders.HttpSecurity $H). ... .csrf(...). ... .disable(...)
      - pattern: (org.springframework.security.config.annotation.web.configurers.CsrfConfigurer<HttpSecurity> $C). ... .disable();
    message: |
      The application fails to protect against Cross-Site Request Forgery (CSRF)
      due to disabling Spring's CSRF protection features.

      This vulnerability may allow attackers to carry out CSRF attacks by crafting 
      malicious links or forms on external websites. Victims who are tricked into 
      accessing these links while authenticated in your application could inadvertently 
      perform actions that the attacker intends, such as changing user information, 
      initiating transactions, or altering permissions.

      To remediate this issue, remove the call to `HttpSecurity.csrf().disable()` or 
      remove the custom `CsrfConfigurer`.

      For more information on CSRF protection in Spring see:
      https://docs.spring.io/spring-security/reference/servlet/exploits/csrf.html#servlet-csrf

      Additionally, consider setting all session cookies to have the `SameSite=Strict` 
      attribute. It should be noted that this may impact usability when sharing links 
      across other mediums.
      It is recommended that a two cookie based approach is taken, as outlined in the
      [Top level
      navigations](https://datatracker.ietf.org/doc/html/draft-ietf-httpbis-rfc6265bis-08#section-8.8.2)
      section of the SameSite RFC.

      For more information on CSRF see OWASP's guide:
      https://owasp.org/www-community/attacks/csrf
    metadata:
      shortDescription: "Cross-Site Request Forgery (CSRF)"
      category: "security"
      cwe: "CWE-352"
      owasp:
        - "A5:2017-Broken Access Control"
        - "A01:2021-Broken Access Control"
      security-severity: "Medium"
    severity: "WARNING"
