{
  "version": "1.0",
  "description": "Unified node configuration validation rules",
  "rules": {
    "router_node": {
      "fields": {
        "routes": {
          "type": "array",
          "required": true,
          "minLength": 1,
          "errorMessages": {
            "required": "Router node must have at least one route rule",
            "type": "Routes must be an array",
            "minLength": "Router node must have at least one route rule"
          },
          "items": {
            "type": "object",
            "fields": {
              "id": {
                "type": "string",
                "required": true,
                "pattern": "^[a-zA-Z0-9_-]+$",
                "errorMessages": {
                  "required": "Route rule must have an id",
                  "type": "Route rule id must be a string",
                  "pattern": "Route rule id must contain only letters, numbers, hyphens, and underscores"
                }
              },
              "condition": {
                "type": "string",
                "required": true,
                "minLength": 1,
                "errorMessages": {
                  "required": "Condition is required",
                  "type": "Condition must be a string",
                  "minLength": "Condition cannot be empty"
                }
              },
              "targetEdgeKey": {
                "type": "string",
                "required": true,
                "minLength": 1,
                "pattern": "^[a-zA-Z0-9_-]+$",
                "errorMessages": {
                  "required": "Target edge key is required",
                  "type": "Target edge key must be a string",
                  "minLength": "Target edge key cannot be empty",
                  "pattern": "Target edge key must contain only letters, numbers, hyphens, and underscores"
                }
              },
              "label": {
                "type": "string",
                "required": true,
                "minLength": 1,
                "maxLength": 50,
                "errorMessages": {
                  "required": "Route label is required",
                  "type": "Route label must be a string",
                  "minLength": "Route label cannot be empty",
                  "maxLength": "Route label must be 50 characters or less"
                }
              },
              "priority": {
                "type": "number",
                "required": false,
                "minimum": 0,
                "maximum": 1000,
                "errorMessages": {
                  "type": "Priority must be a number",
                  "minimum": "Priority must be non-negative",
                  "maximum": "Priority must be 1000 or less"
                }
              }
            }
          }
        },
        "defaultRoute": {
          "type": "string",
          "required": false,
          "pattern": "^[a-zA-Z0-9_-]*$",
          "errorMessages": {
            "type": "Default route must be a string",
            "pattern": "Default route must contain only letters, numbers, hyphens, and underscores"
          }
        }
      },
      "customValidation": {
        "message": "Router configuration has validation issues",
        "rules": [
          {
            "name": "unique_target_keys",
            "condition": "routes is not None and len(set(r['targetEdgeKey'] for r in routes if r.get('targetEdgeKey'))) == len([r for r in routes if r.get('targetEdgeKey')])",
            "errorMessage": "All route rules must have unique target edge keys"
          },
          {
            "name": "default_route_not_in_routes",
            "condition": "not defaultRoute or not routes or defaultRoute not in [r.get('targetEdgeKey') for r in routes if r.get('targetEdgeKey')]",
            "errorMessage": "Default route should not be the same as any route target key to avoid conflicts"
          }
        ]
      }
    },
    "loop_condition_node": {
      "fields": {
        "conditionType": {
          "type": "string",
          "required": false,
          "enum": ["forEach", "while", "doWhile"],
          "default": "while",
          "errorMessages": {
            "enum": "Loop type must be 'forEach', 'while', or 'doWhile'"
          }
        },
        "condition": {
          "type": "string",
          "required": false,
          "conditionalRequired": {
            "condition": "conditionType in ['while', 'doWhile'] or conditionType is null",
            "errorMessage": "Condition expression is required for while/doWhile loops"
          },
          "errorMessages": {
            "type": "Condition expression must be a string"
          }
        },
        "listVariable": {
          "type": "string",
          "required": false,
          "conditionalRequired": {
            "condition": "conditionType == 'forEach'",
            "errorMessage": "List variable is required for forEach loops"
          },
          "errorMessages": {
            "type": "List variable must be a string"
          }
        },
        "maxIterations": {
          "type": "number",
          "required": true,
          "minimum": 1,
          "maximum": 100,
          "errorMessages": {
            "required": "Max iterations is required",
            "type": "Max iterations must be a number",
            "minimum": "Max iterations must be greater than 0",
            "maximum": "Max iterations should not exceed 100"
          }
        }
      }
    },
    "tool_node": {
      "fields": {
        "tool_name": {
          "type": "string",
          "required": true,
          "minLength": 1,
          "errorMessages": {
            "required": "Tool name is required",
            "type": "Tool name must be a string",
            "minLength": "Tool name cannot be empty"
          }
        },
        "input_mapping": {
          "type": "object",
          "required": false,
          "errorMessages": {
            "type": "Input mapping must be an object"
          }
        }
      }
    },
    "function_node": {
      "fields": {
        "function_name": {
          "type": "string",
          "required": false,
          "exclusiveWith": ["function_code"],
          "errorMessages": {
            "type": "Function name must be a string"
          }
        },
        "function_code": {
          "type": "string",
          "required": false,
          "exclusiveWith": ["function_name"],
          "errorMessages": {
            "type": "Function code must be a string"
          }
        }
      },
      "customValidation": {
        "message": "Either function_name or function_code must be provided",
        "condition": "function_name or function_code"
      }
    },
    "aggregator_node": {
      "fields": {
        "error_strategy": {
          "type": "string",
          "required": false,
          "enum": ["fail_fast", "best_effort"],
          "default": "fail_fast",
          "errorMessages": {
            "enum": "Error strategy must be 'fail_fast' or 'best_effort'"
          }
        }
      }
    },
    "json_parser_node": {
      "fields": {
        "jsonpath_query": {
          "type": "string",
          "required": false,
          "errorMessages": {
            "type": "JSONPath query must be a string"
          }
        },
        "json_schema": {
          "type": "object",
          "required": false,
          "errorMessages": {
            "type": "JSON Schema must be an object"
          }
        }
      },
      "customValidation": {
        "message": "Either jsonpath_query or json_schema must be provided",
        "condition": "jsonpath_query or json_schema"
      }
    },
    "http_request_node": {
      "fields": {
        "method": {
          "type": "string",
          "required": false,
          "enum": ["GET", "POST", "PUT", "DELETE", "PATCH"],
          "default": "GET",
          "errorMessages": {
            "enum": "Invalid HTTP method"
          }
        },
        "url": {
          "type": "string",
          "required": true,
          "pattern": "^https?://",
          "errorMessages": {
            "required": "URL is required",
            "type": "URL must be a string",
            "pattern": "URL must start with http:// or https://"
          }
        },
        "headers": {
          "type": "object",
          "required": false,
          "errorMessages": {
            "type": "Headers must be an object"
          }
        },
        "max_retries": {
          "type": "number",
          "required": false,
          "minimum": 0,
          "errorMessages": {
            "type": "Max retries must be a number",
            "minimum": "Max retries must be non-negative"
          }
        },
        "timeout": {
          "type": "number",
          "required": false,
          "minimum": 0.1,
          "errorMessages": {
            "type": "Timeout must be a number",
            "minimum": "Timeout must be positive"
          }
        }
      }
    },
    "condition_agent": {
      "fields": {
        "instruction": {
          "type": "string",
          "required": true,
          "minLength": 1,
          "errorMessages": {
            "required": "Routing instruction is required",
            "type": "Routing instruction must be a string",
            "minLength": "Routing instruction cannot be empty"
          }
        },
        "options": {
          "type": "array",
          "required": false,
          "minLength": 1,
          "items": {
            "type": "string",
            "minLength": 1
          },
          "errorMessages": {
            "type": "Options must be an array",
            "minLength": "At least one route option is required"
          },
          "itemErrors": {
            "type": "Each option must be a string",
            "minLength": "Each option must be non-empty"
          }
        }
      }
    }
  }
}
