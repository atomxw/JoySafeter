# =============================================================================
# JoySafeter - 环境变量配置示例
# =============================================================================
# 复制此文件为 .env 并根据实际情况修改配置值
# cp .env.example .env
# =============================================================================

# -----------------------------------------------------------------------------
# 应用基础配置
# -----------------------------------------------------------------------------
APP_NAME="JoySafeter"
APP_VERSION="0.1.0"
DEBUG=false
ENVIRONMENT=production

# -----------------------------------------------------------------------------
# 服务器配置
# -----------------------------------------------------------------------------
# 应用服务器配置（容器内部配置）
# 注意：这些是应用在容器内部监听的配置，与下面的 Docker Compose 端口映射配置不同
BACKEND_HOST=0.0.0.0      # 应用监听地址（容器内，通常不需要修改）
BACKEND_PORT=8000          # 应用监听端口（容器内端口，通常不需要修改）
RELOAD=false               # 生产环境应设置为 false
WORKERS=4                  # 工作进程数（生产环境建议 4 或更多）

# -----------------------------------------------------------------------------
# 数据库配置 (PostgreSQL)
# -----------------------------------------------------------------------------
# PostgreSQL 环境变量 (用于 FastAPI 应用、docker-compose 和 Alembic)
# 注意: docker-compose.yml 中的 db 服务会使用这些变量
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_DB=joysafeter
POSTGRES_HOST=db
POSTGRES_PORT=5432

# 数据库连接池配置
DATABASE_ECHO=false
DATABASE_POOL_SIZE=10
DATABASE_MAX_OVERFLOW=20

# PostgreSQL 连接池配置 (用于 dynamic_agent)
POSTGRES_MIN_POOL_SIZE=10
POSTGRES_MAX_POOL_SIZE=500
POSTGRES_SSL=disable

# -----------------------------------------------------------------------------
# Redis 配置 (缓存 & 限流)
# -----------------------------------------------------------------------------
# Redis 连接 URL (可选)
# 在 Docker Compose 环境中，如果不配置此变量，将使用默认值 redis://redis:6379/0
# 如果需要使用外部 Redis 或自定义配置（如密码、不同端口等），请在此配置
# 格式: redis://[:密码@]主机:端口/数据库编号
# 示例: redis://redis:6379/0
# 示例（带密码）: redis://:password@redis:6379/0
# REDIS_URL=redis://redis:6379/0
REDIS_POOL_SIZE=10

# Redis 端口映射
# 注意：此变量仅用于本地开发时从宿主机连接 Redis
# Docker Compose 端口映射配置应在 deploy/.env 中设置 REDIS_PORT_HOST
REDIS_PORT_HOST=6379

# -----------------------------------------------------------------------------
# 认证与安全配置
# -----------------------------------------------------------------------------
# JWT 密钥 (生产环境必须修改为强随机字符串)
# 生成方式: python -c "import secrets; print(secrets.token_urlsafe(32))"
SECRET_KEY=your-secret-key-change-in-production-CHANGE-THIS-IN-PRODUCTION

# JWT 算法
ALGORITHM=HS256

# Token 过期时间
ACCESS_TOKEN_EXPIRE_MINUTES=4320
REFRESH_TOKEN_EXPIRE_DAYS=30

# 认证相关配置
DISABLE_AUTH=false
REQUIRE_EMAIL_VERIFICATION=false

# Cookie 配置
COOKIE_NAME=auth_token
COOKIE_DOMAIN=
COOKIE_SECURE=false
COOKIE_SAMESITE=lax

# -----------------------------------------------------------------------------
# CORS 配置
# -----------------------------------------------------------------------------
# CORS 允许的源（用于跨域请求）
# 注意：在 Docker Compose 环境中，docker-compose.yml 会自动设置此值
# 格式: JSON 数组字符串，例如: ["http://localhost:3000","http://localhost:3001"]
# 生产环境示例: ["http://joysafeter.xxx.com","https://joysafeter.xxx.com"]
CORS_ORIGINS=["http://localhost:3000","http://localhost:3001"]

# 前端 URL (用于邮件链接、密码重置等)
# 注意：在 Docker Compose 环境中，docker-compose.yml 会自动设置此值
FRONTEND_URL=http://localhost:3000

# -----------------------------------------------------------------------------
# 邮件/SMTP 配置
# -----------------------------------------------------------------------------
SMTP_HOST=
SMTP_PORT=587
SMTP_USER=
SMTP_PASSWORD=
FROM_EMAIL=noreply@joysafeter.ai
FROM_NAME=JoySafeter

# -----------------------------------------------------------------------------
# 限流配置
# -----------------------------------------------------------------------------
RATE_LIMIT_RPM=60
RATE_LIMIT_RPH=1000

# -----------------------------------------------------------------------------
# 并发控制
# -----------------------------------------------------------------------------
MAX_CONCURRENT_LLM_CALLS=50
MAX_CONCURRENT_PER_USER=5

# -----------------------------------------------------------------------------
# LangGraph 配置
# -----------------------------------------------------------------------------
# Checkpoint 配置已迁移到 CheckpointerManager，使用 POSTGRES_* 环境变量
# CHECKPOINT_ENABLED=true  # 启用 checkpoint 功能

# -----------------------------------------------------------------------------
# Langfuse 可观测性配置 (可选)
# -----------------------------------------------------------------------------
LANGFUSE_ENABLED=false
LANGFUSE_PUBLIC_KEY=
LANGFUSE_SECRET_KEY=
LANGFUSE_HOST=https://cloud.langfuse.com

# -----------------------------------------------------------------------------
# 凭据加密配置
# -----------------------------------------------------------------------------
CREDENTIAL_ENCRYPTION_KEY=

# -----------------------------------------------------------------------------
# Dynamic Agent 相关配置
# -----------------------------------------------------------------------------
LOG_LEVEL=INFO

# Docker 配置
DOCKER_HOST_LIST=
# used to create docker in docker, make sure to give docker host ip if running in docker
DOCKER_HOST_IP=127.0.0.1
# for macos
DOCKER_IMAGE=seclens-engine-arm:0.2
# for other unix
#DOCKER_IMAGE=seclens-engine-amd:0.2
DOCKER_START_MCP_COMMAND="python /app/dynamic_engine/mcp/factory.py"
DOCKER_WORKSPACE=/workspace
DOCKER_CPU_CORES=2
DOCKER_MEM_GB=4
DOCKER_DISK_GB=20
DOCKER_RUN_USER=seclens
DOCKER_RUN_GROUP=seclens

# CTF 模式配置
CTF_MODE_ENABLED=true
CTF_DEFAULT_RISK_LEVEL=low
CTF_MAX_RETRY_ATTEMPTS=3
CTF_REFERENCE_SEARCH_ENABLED=true
CTF_AUTO_DETECT=true
CTF_KNOWLEDGE_HOST_PATH=

# Agent 配置
MAX_AGENT_LEVEL=3
MAX_CONCURRENT_AGENTS=10
AGENT_MAX_INTERACTIVE_STEPS=64
MCP_TOOL_READ_TIMEOUT_SECONDS=3600

# 开发模式配置
SECLENS_DEV_MODE=false
ENGINE_HOST_PATH=
AGENT_HOST_PATH=
ENGINE_NATIVE_PORT=9100

# 数据库重置配置
RESET_DATABASE=false

# Rich CLI 显示配置
RICH_CLI_ENABLED=false

# -----------------------------------------------------------------------------
# 本地开发端口配置（可选）
# -----------------------------------------------------------------------------
# 注意：以下配置仅用于本地开发时从宿主机连接服务
# Docker Compose 端口映射配置应在 deploy/.env 中设置
# 
# 如果使用 Docker Compose 部署，端口映射配置请参考 deploy/.env.example
# 在 deploy 目录下创建 .env 文件并配置端口映射变量：
#   - BACKEND_PORT_HOST
#   - FRONTEND_PORT_HOST
#   - POSTGRES_PORT_HOST
#   - REDIS_PORT_HOST
#   - DEMO_MCP_SERVER_PORT
#   - SCANNER_MCP_PORT
#   - JEB_MCP_PORT
#   - MCP_PORT_3, MCP_PORT_4, MCP_PORT_5
#   - BACKEND_HOST
#   - FRONTEND_HOSTNAME
#   - FRONTEND_URL

# -----------------------------------------------------------------------------
# 构建配置
# -----------------------------------------------------------------------------
PIP_INDEX_URL=https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple
UV_INDEX_URL=https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple

# default model for pentest
DEFAULT_OPENAI_COMPATIBLE_API_BASE=
DEFAULT_OPENAI_COMPATIBLE_API_KEY=
DEFAULT_OPENAI_COMPATIBLE_MODEL=DeepSeek-V3-0324
DEFAULT_OPENAI_COMPATIBLE_MODEL_TIMEOUT=300