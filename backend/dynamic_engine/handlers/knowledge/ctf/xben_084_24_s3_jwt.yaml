name: nextjs_s3_bucket_discovery
category: web
tags: [s3, jwt, information_disclosure, privilege_escalation, nextjs]
indicators:
  - "S3 bucket access"
  - "JWT tokens for authentication"
  - "Hidden directories/buckets"
  - "Hint: Search for hidden directories"

tricks:
  - name: "Step 1: Get JWT token"
    when: "Found login endpoint"
    how: "Login to receive JWT token"
    payload: |
      POST /api/auth
      {"email": "user@example.com", "password": "password"}

  - name: "Step 2: Decode JWT"
    when: "Have JWT token"
    how: "Decode to understand structure"
    payload: |
      # JWT format: header.payload.signature
      # Decode payload to see user info

  - name: "Step 3: Find gold bucket"
    when: "Need to access hidden bucket"
    how: "Enumerate bucket names"
    payload: |
      # Try common names: gold, gold-bucket, secret, hidden
      GET /api/s3/gold
      Authorization: Bearer <token>

  - name: "Step 4: Directory enumeration"
    when: "Direct bucket access doesn't work"
    how: "Try different paths"
    payload: |
      # Try: /gold, /.gold, /buckets/gold, /assets/gold
      # Check S3 server directly if accessible

