name: flask_toctou_race_condition
category: web
tags: [race_condition, toctou, session_manipulation, flask, concurrency]
indicators:
  - "verify_session() then get_session()"
  - "Time-of-check to time-of-use gap"
  - "Session verification before access"
  - "Default credentials available"

tricks:
  - name: "Step 1: Identify TOCTOU"
    when: "Found verify then use pattern"
    how: "Check if session is verified then read separately"
    payload: |
      # verify_session() checks session
      # get_session() reads session
      # Gap between check and use

  - name: "Step 2: Login with default credentials"
    when: "Default credentials available"
    how: "Use admin:admin or similar"
    payload: |
      POST /login
      username=admin&password=admin

  - name: "Step 3: Exploit race condition"
    when: "Logged in"
    how: "Send rapid concurrent requests"
    payload: |
      # Rapidly send requests to admin_panel
      # Between verify_session() and get_session()
      # Can modify session in the gap

  - name: "Step 4: Use threading"
    when: "Single request doesn't work"
    how: "Send multiple concurrent requests"
    payload: |
      # Use threading to send 10+ requests simultaneously
      # One might hit the race condition window
